{% extends "base.html" %}

{% block content %}

    {% load static %} <!-- neither you load static-tag in base.html, you must load static-tag here again -->
    

    <div class="title">
        記事編集
    </div>

    <form method="post" enctype="multipart/form-data" style="width: 80%; margin: 0 auto;" action="{% url 'articles:edit' %}">
        {% csrf_token %}
        <div id="drop-area">
            <div style="margin-top: auto; font-size: 40px; font-weight: bold;">
                <i class="bi bi-image"></i>
            </div>
            <div class="img-form-message">
                ヘッダー画像をアップロード
            </div>
            {{ form.header_img_url }}
        </div>

        <div class="article-item">
            <div>記事タイトル</div>
            {{ form.title }}
        </div>

        <div class="article-item">
            <div>カテゴリ</div>
            {{ form.category }}
        </div>

        <div class="article-item">
            <div>本文</div>
            {{ form.content }}
        </div>
        <button type="submit">作成</button>
    </form>

    <style>
        /* form element */
        #drop-area {
            width: 100%;
            height: 30%;
            background-color: aliceblue;
            border:3px solid black;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            margin-bottom: 30px;
        }
        .img-form-message {
            margin-bottom: auto;
            font-size: 20px;
            font-weight: bold;
        }
        .article_title {
            font-size: 40px;
            font-weight: bold;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            border: none;
            width: 100%;
        }
        .article_category {
            font-size: 20px;
            font-weight: bold;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            border: none;
            /* width: 90%; */
        }
        /* form element end */

        .markdownx {
            display: flex;
            width: 100%;
            flex-direction: row;
        }
        .markdownx .markdownx-editor {
            resize: none;
            height: 500px;
            min-height: 500px;
            width: 50%;
        }
        .markdownx .markdownx-preview {
            width: 50%;
            height: 500px;
            min-height: 500px;
        }
        .markdownx textarea {
            font-size: 15px;
        }
        #drop-area input {
            opacity: 0;
        }
        .article-item {
            width: 100%;
            font-size: 30px;
            font-weight: bold;
            margin-bottom: 30px;
        }
    </style>

    <script>
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('id_header_img_url');

        // 添付した画像ファイルを表示する関数
        function handleFile(imgFIle) {
            const reader = new FileReader();

            reader.readAsDataURL(imgFIle);
            reader.onload = (e) => {
                // 画像がすでに表示されている場合は削除
                if (dropArea.querySelector('img')) {
                    dropArea.querySelector('img').remove();
                }
                // フォームに選択した画像を表示
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = 'Uploaded Image';
                img.style.objectFit = 'covoer';
                img.style.width = '100%';
                img.style.height = '100%';
                dropArea.appendChild(img);
                dropArea.querySelector('.img-form-message').style.display = 'none';
            }

            // 画像フォーム内の要素を非表示にする
            dropArea.querySelector('.bi-image').style.display = 'none';
            dropArea.querySelector('#id_header_img_url').style.display = 'none';
        }

        // エクスプローラーでのファイル選択時の処理
        fileInput.addEventListener('change', (e) => {
            const imgFile = e.target.files[0];
            if (imgFile && imgFile.type.startsWith('image/')) {
                handleFile(imgFile);
            } else {
                fileInput.value = '';
                alert('画像ファイルを選択してください');
            }
        });

        // ドラッグ&ドロップ時の処理
        dropArea.addEventListener('drop', (e) => {
 
            // input要素にファイルをセットするためのDataTransferオブジェクトを作成
            const imgFile = e.dataTransfer.files[0];
            const dataTransfer = new DataTransfer();

            // 選択したファイルが画像ファイルかどうかを判定
            if (imgFile && imgFile.type.startsWith('image/')) {
                // input要素にファイルをセット
                dataTransfer.items.add(imgFile);
                fileInput.files = dataTransfer.files;
                handleFile(imgFile);
            } else {
                alert('画像ファイルを選択してください');
            }
        });

        dropArea.addEventListener('click', () => {
            fileInput.click();
        });

    </script>



{% endblock %}